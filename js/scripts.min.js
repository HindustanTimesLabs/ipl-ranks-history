function ready(t,e,i,r){function a(){var t=$(".navbar").height();$(window).scrollTop()>=n-t?($("#legend").css({position:"fixed",top:t,background:"rgba(255, 255, 255, 0.9)",left:0}),$("#story").css({"margin-top":$("#legend").height()})):($("#legend").css({position:"static","box-shadow":"none"}),$("#story").css({"margin-top":0}))}function o(t){function a(e){o(slugify(e.id));var a=[0,0];a=d3.mouse(this);var n=a[0],s=(a[1],e.id),l=Math.round(p[t].invert(n)),d=e.values.filter(function(t){return t.index==l})[0].position,c=i.filter(function(t){return t.index==l})[0].date,u=r.filter(function(t){return t.date==c&&t.team==s})[0];if(void 0!=u)var f=u.wins,v=u.losses;var h=1==d?"st":2==d?"nd":3==d?"rd":"th";$(".viz-wrapper.vw-"+t+" .tip").show(),$(".viz-wrapper.vw-"+t+" .tip").empty(),$(".viz-wrapper.vw-"+t+" .tip").addClass("show-"+d),$(".viz-wrapper.vw-"+t+" .tip").append("<div class='title'>"+s+"</div>"),$(".viz-wrapper.vw-"+t+" .tip").append("<div class='date'>"+formatDate(c)+"</div>"),$(".viz-wrapper.vw-"+t+" .tip").append("<div class='position'>"+d+h+" place</div>"),void 0!=u&&$(".viz-wrapper.vw-"+t+" .tip").append("<table class='wl-table'><tr class='head'><td>Wins</td><td>Losses</td></tr><tr><td>"+f+"</td><td>"+v+"</td></tr></table>");var w=$(".viz-wrapper.vw-"+t).offset().top-$(".viz-wrapper.vw-"+t+" .tip").height(),m=(window.innerWidth,p[t](l)-15);$(".tip").css({top:w-10,left:m,border:"2px solid "+colors.filter(function(t){return slugify(e.id)==t.slug})[0].bg})}function o(e){d3.selectAll(".viz-wrapper.vw-"+t+" .team.unset .line-out").style("opacity",".2"),d3.selectAll(".viz-wrapper.vw-"+t+" .team.unset .line").style("opacity",".2"),d3.select(".viz-wrapper.vw-"+t+" .line-out."+e).style("opacity",stroke_on.opacity).style("stroke-width",stroke_on.width+6),d3.select(".viz-wrapper.vw-"+t+" .line."+e).style("opacity",stroke_on.opacity).style("stroke-width",stroke_on.width),d3.select(".viz-wrapper.vw-"+t+" .team."+e).moveToFront()}function n(){$(".team").hasClass("set")?(d3.selectAll(".viz-wrapper.vw-"+t+" .team.unset .line-out").style("opacity",".2").style("stroke-width",stroke_off.width+4),d3.selectAll(".viz-wrapper.vw-"+t+" .team.unset .line").style("opacity",".2").style("stroke-width",stroke_off.width),d3.select(".viz-wrapper.vw-"+t+" .team.set").moveToFront()):(d3.selectAll(".viz-wrapper.vw-"+t+" .team.unset .line-out").style("opacity",stroke_off.opacity).style("stroke-width",stroke_off.width+4),d3.selectAll(".viz-wrapper.vw-"+t+" .team.unset .line").style("opacity",stroke_off.opacity).style("stroke-width",stroke_off.width)),$(".viz-wrapper.vw-"+t+" .tip").hide()}lookup_obj[t]=i,positions_obj[t]=e,year_indexes[t]="all"!=t?lookup_obj[t].filter(function(e){return e.year==t}).map(function(t){return t.index.toString()}):lookup_obj[t].map(function(t){return t.index.toString()}),year_indexes[t].forEach(function(e){var i=positions_obj[t].filter(function(t){return t.index==e});positions_filtered[t].push(i[0])});var s=positions_filtered[t];s.columns=positions_obj[t].columns;var l={},d={},p={},c={},u={},f={},v={},h={};l[t]=d3.select(".viz-wrapper.vw-"+t).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),d[t]=l[t].append("g").attr("transform","translate("+margin.left+","+margin.top+")"),p[t]=d3.scaleLinear().range([0,width]),c[t]=d3.scaleLinear().range([height,0]),u[t]=d3.axisTop(p[t]).tickValues(tickValues_obj[t]).tickSizeInner(-height-margin.bottom),f[t]=d3.axisLeft(c[t]).ticks("all"==t?10:8),v[t]=d3.axisRight(c[t]).ticks("all"==t?10:8),h[t]=d3.line().curve(d3.curveBundle.beta(1)).x(function(e){return p[t](e.index)}).y(function(e){return c[t](e.position)}).defined(function(t){return!isNaN(t.position)}),s.forEach(function(t,e,i){for(var r,a=1,o=i.length;a<o;++a)t[r=i[a]]=+t[r];return t}),i.forEach(function(t){return t.index=+t.index,t});var w=s.columns.slice(1).map(function(t){return{id:t,values:s.map(function(e){return{index:+e.index,position:+e[t]}})}});p[t].domain(d3.extent(s,function(t){return+t.index})),c[t].domain([d3.max(w,function(t){return d3.max(t.values,function(t){return t.position})}),d3.min(w,function(t){return d3.min(t.values,function(t){return t.position})})]),u[t].tickFormat(function(e){var r=i.filter(function(t){return t.index==e})[0].date;return"all"==t?formatYear(r):formatMonth(r)}),d[t].append("g").attr("class","axis axis--x").attr("transform","translate(0,-10)").call(u[t]).append("text").attr("class","time-label").attr("y",-18).attr("x","all"==t?16:24).text("all"==t?"Year":"Month"),d3.selectAll(".axis.axis--x .tick text").attr("text-anchor","start");var m=d[t].append("g").attr("class","axis axis--y").call(f[t]).attr("transform","translate(-20,0)");m.append("text").attr("class","time-label").attr("transform","rotate(-90)").attr("y",30-margin.left).attr("dy","0.71em").attr("fill","#000").text("Best →"),m.append("text").attr("class","time-label").attr("transform","rotate(-90)").attr("y",30-margin.left).attr("x",-height).attr("text-anchor","start").attr("dy","0.71em").attr("fill","#000").text("← Worst");var g=(d[t].append("g").attr("class","axis axis--y").call(v[t]).attr("transform","translate("+width+",0)"),d[t].selectAll(".team").data(w).enter().append("g").attr("class",function(t){return"team unset "+slugify(t.id)}).on("mouseover",a).on("mouseout",n));g.append("path").attr("class",function(t){return"line-out "+slugify(t.id)}).attr("d",function(e){return h[t](e.values)}).style("stroke",function(t){return colors.filter(function(e){return e.slug==slugify(t.id)})[0].bg}).style("stroke-width",stroke_off.width+4).style("opacity",stroke_off.opacity).on("mouseover",a).on("mouseout",n),g.append("path").attr("class",function(t){return"line "+slugify(t.id)}).attr("d",function(e){return h[t](e.values)}).style("stroke",function(t){return"url(#diagonalHatch-"+slugify(t.id)+")"}).style("stroke-width",stroke_off.width).style("opacity",stroke_off.opacity).on("mousemove",a).on("mouseout",n),$(document).on("mouseover",".body-select",function(){var e=$(this).attr("team");console.log(e),o(e,t)}).mouseout(function(){n()}),$("#all-seasons-select select").append("<option></option>"),_.sortBy(w,"id").forEach(function(t){$("#all-seasons-select select").append("<option value='"+slugify(t.id)+"'>"+t.id+"</option>")}),$("#all-seasons-select select").chosen({allow_single_deselect:!0}).change(function(){var t=$(this).val();""==t?($(".team").removeClass("set").addClass("unset"),n()):($(".team").removeClass("set").addClass("unset"),$(".team."+t).removeClass("unset").addClass("set"),o(t))}),$(".viz-wrapper.vw-"+t).append("<div class='tip'></div>"),$(".viz-wrapper.vw-"+t+" .tip").hide()}if(t)throw t;$("#all-teams").width("100%"),$("#legend").width("100%");var n=$("#legend").offset().top;win_width>768&&($(window).scroll(function(){a()}),a()),years.forEach(o)}function slugify(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function formatDate(t){var e=t.split("-");return void 0==e[2]?" ":e[0]+" "+e[1]+", 20"+e[2]}function formatMonth(t){var e=t.split("-");return void 0==e[2]?" ":e[1]+", 20"+e[2]}function formatYear(t){var e=t.split("-");return void 0==e[2]?" ":"20"+e[2]}var win_width=$(window).width();win_width<=768?($(".click-tap").html("Tap"),$(".body-select a").attr("href","javascript: void(0)")):$(".click-tap").html("drag your cursor over");var margin={top:40,right:70,bottom:20,left:70},width=window.innerWidth-margin.left-margin.right;height=190-margin.top-margin.bottom;var stroke_off={width:6,opacity:1},stroke_on={width:stroke_off.width+.1*stroke_off.width,opacity:1},pattern_dim="8",pattern_stroke="3.5",choro_path="M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2",choro_dim="4",choro_stroke="1.8";colors.forEach(function(t){$("#patterns").append('<svg width="1" height="1"><defs><pattern id="diagonalHatch-'+t.slug+'" patternUnits="userSpaceOnUse" width="8" height="8"><path d="M-1,1 l4,-4 M0,8 l8,-8 M7,9 l4,-4" style="stroke:'+t.color+'; stroke-width:3.5"></path></pattern></defs></svg>')});var years=["all","2016","2015","2014","2013","2012","2011","2010","2009","2008"],tickValues_obj={all:[1,46,84,128,178,230,282,324,369],2016:[369,391],2015:[324,347],2014:[282,297],2013:[230,258],2012:[178,205],2011:[128,151],2010:[84,104],2009:[46,59],2008:[1,14]},positions_filtered={},year_indexes={},positions_obj={},lookup_obj={};years.forEach(function(t){positions_filtered[t]=[],year_indexes[t]=[],positions_obj[t]=[],lookup_obj[t]=[]}),d3.queue().defer(d3.csv,"data/viz2.csv").defer(d3.csv,"data/date_lookup.csv").defer(d3.csv,"data/data.csv").await(ready);